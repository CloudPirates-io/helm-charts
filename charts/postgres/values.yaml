## @section Global parameters
global:
  # -- Global Docker Image registry
  imageRegistry: ""
  # -- Global Docker registry secret names as an array
  imagePullSecrets: []
  # -- Whether to add service links env variables to pods
  enableServiceLinks: true

## @section Common parameters
# -- String to partially override postgres.fullname
nameOverride: ""
# -- String to fully override postgres.fullname
fullnameOverride: ""
# -- Labels to add to all deployed objects
commonLabels: {}
# -- Annotations to add to all deployed objects
commonAnnotations: {}
# -- Priority class name to be used for the pods
priorityClassName: ""

# -- Time for Kubernetes to wait for the pod to gracefully terminate
terminationGracePeriodSeconds: 30

## @section PostgreSQL image configuration
image:
  # -- PostgreSQL image registry
  registry: docker.io
  # -- PostgreSQL image repository
  repository: postgres
  # -- PostgreSQL image tag (immutable tags are recommended)
  tag: "18.1@sha256:5773fe724c49c42a7a9ca70202e11e1dff21fb7235b335a73f39297d200b73a2"
  # -- PostgreSQL image pull policy
  imagePullPolicy: Always
  # -- Set to true when using hardened images (e.g., DHI) that have different PGDATA paths for Postgres <18
  useHardenedImage: false

## @section Deployment configuration
# -- Number of PostgreSQL replicas to deploy (Note: PostgreSQL doesn't support multi-master replication by default)
replicaCount: 1

## @section Pod annotations and labels
# -- Map of annotations to add to the pods
podAnnotations: {}
# -- Map of labels to add to the pods
podLabels: {}

## @section Security Context
podSecurityContext:
  # -- Group ID for the volumes of the pod
  fsGroup: 999

containerSecurityContext:
  # -- Enable container privilege escalation
  allowPrivilegeEscalation: false
  # -- Configure the container to run as a non-root user
  runAsNonRoot: true
  # -- User ID for the PostgreSQL container
  runAsUser: 999
  # -- Group ID for the PostgreSQL container
  runAsGroup: 999
  # -- Mount container root filesystem as read-only
  readOnlyRootFilesystem: false
  # -- Linux capabilities to be dropped
  capabilities:
    drop:
      - ALL

## @section PostgreSQL Authentication
auth:
  # -- Name for a custom superuser to create at initialisation. (This will also create a database with the same name)
  username: ""
  # -- Password for the custom user to create
  password: ""
  # -- Alternative name for the default database to be created at initialisation
  database: ""
  # -- Name of existing secret to use for PostgreSQL credentials
  existingSecret: ""
  secretKeys:
    # -- Name of key in existing secret to use for PostgreSQL admin credentials
    adminPasswordKey: "postgres-password"

## @section PostgreSQL Configuration
config:
  # -- Enable mounting of ConfigMap with PostgreSQL configuration
  mountConfigMap: true
  # -- Shared preload libraries (comma-separated list)
  postgresqlSharedPreloadLibraries: ""
  # -- Maximum number of connections
  postgresqlMaxConnections: 100
  # -- Amount of memory the database server uses for shared memory buffers
  postgresqlSharedBuffers: ""
  # -- Effective cache size
  postgresqlEffectiveCacheSize: ""
  # -- Amount of memory to be used by internal sort operations and hash tables
  postgresqlWorkMem: ""
  # -- Maximum amount of memory to be used by maintenance operations
  postgresqlMaintenanceWorkMem: ""
  # -- Amount of memory used in shared memory for WAL data (deprecated, see postgresql.wal.buffers)
  postgresqlWalBuffers: ""
  # -- Time spent flushing dirty buffers during checkpoint, as fraction of checkpoint interval
  postgresqlCheckpointCompletionTarget: ""
  # -- Sets the planner's estimate of the cost of a non-sequentially-fetched disk page
  postgresqlRandomPageCost: ""
  # -- Sets the type of statements logged
  postgresqlLogStatement: ""
  # -- Sets the minimum execution time above which statements will be logged
  postgresqlLogMinDurationStatement: ""
  # -- Additional PostgreSQL configuration parameters
  extraConfig: []
  # -- Name of existing ConfigMap with PostgreSQL configuration
  existingConfigmap: ""
  # -- Content of a custom pg_hba.conf file to be used instead of the default config
  pgHbaConfig: ""
  postgresql:
    # -- Default timezone setting
    timezone: "UTC"
    # -- Default locale setting
    locale: "en_US.utf8"
    # -- WAL settings

## @section customUser Optional user to be created at initialisation with a custom password and database
customUser:
  # -- Name of the custom user to be created
  name: ""
  # -- Name of the database to be created
  database: ""
  # -- Password to be used for the custom user
  password: ""
  # -- Existing secret, in which username, password and database name are saved
  existingSecret: ""
  secretKeys:
    # -- Custom user name secret reference (set empty to fallback to customUser.name)
    name: "CUSTOM_USER"
    # -- Custom user database secret reference (set empty to fallback to customUser.database)
    database: "CUSTOM_DB"
    password: "CUSTOM_PASSWORD"

## @section PostgreSQL Initdb configuration
initdb:
  # -- Send arguments to postgres initdb. This is a space separated string of arguments
  args: ""
  # -- Dictionary of initdb scripts
  scripts: {}
  # -- ConfigMap with scripts to be run at first boot
  scriptsConfigMap: ""
  # -- Directory where to load initScripts
  directory: "/docker-entrypoint-initdb.d/"

## @section Service configuration
service:
  # -- PostgreSQL service type
  type: ClusterIP
  # -- PostgreSQL service port
  port: 5432
  # -- PostgreSQL container port
  targetPort: 5432
  # -- PostgreSQL NodePort port
  nodePort: 30432
  # -- Service annotations
  annotations: {}

## @section Ingress configuration
ingress:
  # -- Enable ingress record generation for PostgreSQL
  enabled: false
  # -- IngressClass that will be used to implement the Ingress
  className: ""
  # -- Additional annotations for the Ingress resource
  annotations: {}
  hosts:
    -
      # -- Hostname
      host: postgres.local
      paths:
        -
          # -- Base path
          path: /
          # -- Path type
          pathType: Prefix
  # -- TLS configuration for PostgreSQL ingress
  tls: []
  #  - secretName: postgres-tls
  #    hosts:
  #      - postgres.local

## @section Resources
resources: {}
  ## We usually recommend not to specify default resources and to leave this as a conscious
  ## choice for the user. This also increases chances charts run on environments with little
  ## resources, such as Minikube. If you do want to specify resources, uncomment the following
  ## lines, adjust them as necessary, and remove the curly braces after 'resources:'.
  # limits:
  #   cpu: 500m
  #   memory: 512Mi
  # requests:
  #   cpu: 250m
  #   memory: 256Mi

## @section Persistence
persistence:
  # -- Enable persistence using Persistent Volume Claims
  enabled: true
  # -- Persistent Volume storage class
  storageClass: ""
  # -- Persistent Volume Claim annotations
  annotations: {}
  # -- Persistent Volume size
  size: 8Gi
  # -- Persistent Volume access modes
  accessModes:
    - ReadWriteOnce
  # -- The name of an existing PVC to use for persistence
  existingClaim: ""
  # -- The subdirectory of the volume to mount to
  ## Useful in dev environments and one PV for multiple services
  subPath: ""
  # -- Labels for persistent volume claims
  labels: {}
  # -- Container volume name and volume claim prefix
  volumeName: "data"

## @section Persistent Volume Claim Retention Policy
persistentVolumeClaimRetentionPolicy:
  # -- Enable Persistent volume retention policy for the Statefulset
  enabled: false
  # -- Volume retention behavior when the replica count of the StatefulSet is reduced
  whenScaled: Retain
  # -- Volume retention behavior that applies when the StatefulSet is deleted
  whenDeleted: Retain

## @section Liveness and readiness probes
livenessProbe:
  # -- Enable livenessProbe on PostgreSQL containers
  enabled: true
  # -- Initial delay seconds for livenessProbe
  initialDelaySeconds: 30
  # -- Period seconds for livenessProbe
  periodSeconds: 10
  # -- Timeout seconds for livenessProbe
  timeoutSeconds: 5
  # -- Failure threshold for livenessProbe
  failureThreshold: 3
  # -- Success threshold for livenessProbe
  successThreshold: 1

readinessProbe:
  # -- Enable readinessProbe on PostgreSQL containers
  enabled: true
  # -- Initial delay seconds for readinessProbe
  initialDelaySeconds: 5
  # -- Period seconds for readinessProbe
  periodSeconds: 5
  # -- Timeout seconds for readinessProbe
  timeoutSeconds: 5
  # -- Failure threshold for readinessProbe
  failureThreshold: 3
  # -- Success threshold for readinessProbe
  successThreshold: 1

startupProbe:
  # -- Enable startupProbe on PostgreSQL containers
  enabled: true
  # -- Initial delay seconds for startupProbe
  initialDelaySeconds: 30
  # -- Period seconds for startupProbe
  periodSeconds: 10
  # -- Timeout seconds for startupProbe
  timeoutSeconds: 5
  # -- Failure threshold for startupProbe
  failureThreshold: 30
  # -- Success threshold for startupProbe
  successThreshold: 1

## @section Node Selection
# -- Node labels for pod assignment
nodeSelector: {}

# -- Toleration labels for pod assignment
tolerations: []

# -- Affinity settings for pod assignment
affinity: {}

serviceAccount:
  # -- Specifies whether a service account should be created
  create: false
  # -- Annotations to add to the service account
  annotations: {}
  # -- The name of the service account to use. If not set and create is true, a name is generated using the `fullname` template.
  name: ""
  # -- Whether to automount the SA token inside the pod
  automountServiceAccountToken: false

# -- Additional environment variables to set
extraEnvVars: []
  # - name: CUSTOM_VAR
  #   value: "custom-value"
  # - name: SECRET_VAR
  #   valueFrom:
  #     secretKeyRef:
  #       name: my-secret
  #       key: secret-key

# -- Name of a secret containing additional environment variables
extraEnvVarsSecret: ""

# -- Additional volumes to add to the pod
extraVolumes: []

# -- Additional volume mounts to add to the MongoDB container
extraVolumeMounts: []

# -- Init containers to add to the PostgreSQL pods. Useful for tasks like pgautoupgrade for major version upgrades
initContainers: []
# Example with pgautoupgrade for major version upgrades:
# - name: pgautoupgrade
#   image: tianon/pgautoupgrade:17-to-18
#   volumeMounts:
#     - name: data  # must match persistence.volumeName
#       mountPath: /var/lib/postgresql/data

## @section Container command/args override
# -- Override default container command (useful for hardened images)
command: []
# -- Override default container args (useful for hardened images that handle startup differently)
## Leave unset or null to use default args, set to empty array [] to disable default args for hardened images like DHI
args: null  # @schema type:[array, null]

# -- Array of extra objects to deploy with the release
extraObjects: []

## @section Metrics configuration
metrics:
  # -- Start a sidecar prometheus exporter to expose PostgreSQL metrics
  enabled: false
  image:
    # -- PostgreSQL exporter image registry
    registry: quay.io
    # -- PostgreSQL exporter image repository
    repository: prometheuscommunity/postgres-exporter
    # -- PostgreSQL exporter image tag
    tag: "v0.18.1@sha256:fb96c4413985d4b23ab02b19022b3d70a86c8e0a62f41ab15ebb6f4673781a5d"
    # -- PostgreSQL exporter image pull policy
    pullPolicy: Always
  # -- Resource limits and requests for metrics container
  resources: {}
  ## Metrics service configuration
  service:
    # -- Additional custom annotations for Metrics service
    annotations: {}
    # -- Additional custom labels for Metrics service
    labels: {}
    # -- Metrics service port
    port: 9187
  ## Prometheus Operator ServiceMonitor configuration
  serviceMonitor:
    # -- Create ServiceMonitor resource(s) for scraping metrics using PrometheusOperator
    enabled: false
    # -- The namespace in which the ServiceMonitor will be created
    namespace: ""
    # -- The interval at which metrics should be scraped
    interval: 30s
    # -- The timeout after which the scrape is ended
    scrapeTimeout: 10s
    # -- Additional labels for ServiceMonitor resource
    selector: {}
    # -- ServiceMonitor annotations
    annotations: {}
    # -- honorLabels chooses the metric's labels on collisions with target labels
    honorLabels: false
    # -- ServiceMonitor relabel configs to apply to samples before scraping
    relabelings: []
    # -- ServiceMonitor metricRelabelings configs to apply to samples before ingestion
    metricRelabelings: []
    # -- ServiceMonitor namespace selector
    namespaceSelector: {}

replication:
  # -- Enables the WAL replication feature for both sides (primary and standby)
  enabled: false
  primary:
    # -- Hostname of the primary server
    host: ""
    # -- Port of the primary server
    port: 5432
  auth:
    # -- Username for replication user
    username: "replication"
    # -- Password for replication user (cannot be empty)
    password: ""
    # -- Use existing secret reference instead of password
    existingSecret: ""
    secretKeys:
      # -- Secret key for replication password
      password: "replication-password"
  allowFrom:
    # -- Allowed IPv4 network (set empty to disable that feature)
    ipv4: "0.0.0.0/0"
    # -- Allowed IPv6 network (set empty to disable that feature)
    ipv6: "::/0"
